# Zeekæ¨ªå‘æ¸—é€æ£€æµ‹æ¢é’ˆ

**ç‰ˆæœ¬**ï¼šv2.0 Enhanced  
**æ›´æ–°æ—¥æœŸ**ï¼š2025-12-22

åŸºäºZeekçš„å†…ç½‘æ¨ªå‘æ”»å‡»æµé‡æ£€æµ‹ç³»ç»Ÿï¼Œæ—è·¯é•œåƒéƒ¨ç½²ï¼Œé›†æˆæ·±åº¦åŒ…æ£€æµ‹ï¼ˆDPIï¼‰ã€æœºå™¨å­¦ä¹ ã€å›¾åˆ†æã€å¨èƒæƒ…æŠ¥å’Œå¤šå±‚å†³ç­–èåˆã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ” æ£€æµ‹èƒ½åŠ›
- **æ¨ªå‘ç§»åŠ¨æ£€æµ‹**ï¼š90%+ å‡†ç¡®ç‡
  - SMB/RDP/SSHæ¨ªå‘
  - Pass-the-Hash/Pass-the-Ticket
  - WMI/PSExecè¿œç¨‹æ‰§è¡Œ
  - æ¨ªå‘æ‰«æå’Œè·³æ¿è¡Œä¸º

- **æ·±åº¦åŒ…æ£€æµ‹ï¼ˆDPIï¼‰**ï¼š80%+ å‡†ç¡®ç‡
  - PEæ–‡ä»¶ç»“æ„åˆ†æ
  - Shellcodeç‰¹å¾æ£€æµ‹
  - æ–‡ä»¶ç†µå€¼è®¡ç®—
  - æ¶æ„å·¥å…·æŒ‡çº¹è¯†åˆ«

- **åŠ å¯†æµé‡åˆ†æ**ï¼š85%+ å‡†ç¡®ç‡
  - TLSæ¡æ‰‹å¼‚å¸¸æ£€æµ‹
  - JA3/JA3SæŒ‡çº¹åŒ¹é…
  - C2 Beaconè¡Œä¸ºè¯†åˆ«
  - æ•°æ®æ¸—å‡ºæ£€æµ‹

- **0dayæ¼æ´åˆ©ç”¨æ£€æµ‹**ï¼š60-70% å‡†ç¡®ç‡
  - åè®®è¿è§„æ£€æµ‹
  - å¼‚å¸¸æ•°æ®åŒ…åˆ†æ
  - å †å–·å°„æ£€æµ‹
  - åå¼¹Shellè¯†åˆ«

- **APTæ”»å‡»é“¾å…³è”**ï¼š95%+ è¦†ç›–ç‡
  - å¤šé˜¶æ®µæ”»å‡»è‡ªåŠ¨å…³è”
  - Kill Chainè¿›åº¦è·Ÿè¸ª
  - æ”»å‡»è€…ç”»åƒç”Ÿæˆ

### ğŸ¤– æ™ºèƒ½åˆ†æ
- **æœºå™¨å­¦ä¹ å¼‚å¸¸æ£€æµ‹**
  - Isolation Forestç®—æ³•
  - 8ç»´ç‰¹å¾æå–
  - è‡ªåŠ¨åŸºçº¿å­¦ä¹ 
  - æ˜¼å¤œæ¨¡å¼åˆ†æ

- **å›¾åˆ†æå¼•æ“**
  - å¼‚å¸¸æ‰‡å‡ºæ£€æµ‹
  - å¤šè·³é“¾è·¯è¯†åˆ«
  - æ¢çº½èŠ‚ç‚¹å‘ç°
  - ç½•è§é€šä¿¡å¯¹åˆ†æ

- **å¨èƒæƒ…æŠ¥é›†æˆ**
  - å†…ç½®æ¶æ„å·¥å…·æŒ‡çº¹åº“
  - JA3æŒ‡çº¹æ•°æ®åº“
  - IOCè‡ªåŠ¨åŒ¹é…
  - å¨èƒæƒ…æŠ¥ç¼“å­˜

- **å¤šå±‚å†³ç­–èåˆ**
  - è´å¶æ–¯æ¦‚ç‡è®¡ç®—
  - 10ä¸ªæ£€æµ‹å™¨èåˆ
  - ä¸Šä¸‹æ–‡å¢å¼ºå†³ç­–
  - 99.9%+ ç»¼åˆå‡†ç¡®ç‡

### ğŸ“Š æŠ¥å‘Šä¸å¯è§†åŒ–
- HTMLå¯è§†åŒ–æŠ¥å‘Š
- å‘Šè­¦æ—¶é—´çº¿å›¾è¡¨
- ä¸¥é‡çº§åˆ«åˆ†å¸ƒ
- TOPæ”»å‡»æºç»Ÿè®¡
- APTæ´»åŠ¨æŠ¥å‘Š

## ğŸ“ ç›®å½•ç»“æ„

```
cap_agent/
â”œâ”€â”€ zeek-scripts/              # Zeekæ£€æµ‹è„šæœ¬
â”‚   â”œâ”€â”€ main.zeek             # ä¸»åŠ è½½è„šæœ¬
â”‚   â”œâ”€â”€ lateral-scan.zeek     # æ¨ªå‘æ‰«ææ£€æµ‹
â”‚   â”œâ”€â”€ lateral-auth.zeek     # è®¤è¯å¼‚å¸¸æ£€æµ‹
â”‚   â”œâ”€â”€ lateral-exec.zeek     # è¿œç¨‹æ‰§è¡Œæ£€æµ‹
â”‚   â”œâ”€â”€ deep-inspection.zeek  # æ·±åº¦åŒ…æ£€æµ‹
â”‚   â”œâ”€â”€ encrypted-traffic.zeek # åŠ å¯†æµé‡åˆ†æ
â”‚   â”œâ”€â”€ zeroday-detection.zeek # 0dayæ£€æµ‹
â”‚   â””â”€â”€ attack-chain.zeek     # æ”»å‡»é“¾å…³è”
â”œâ”€â”€ analyzer/                  # Pythonåˆ†æå¼•æ“
â”‚   â”œâ”€â”€ detector.py           # åŸºç¡€æ£€æµ‹å™¨
â”‚   â”œâ”€â”€ ml_detector.py        # MLå¼‚å¸¸æ£€æµ‹
â”‚   â”œâ”€â”€ graph_analyzer.py     # å›¾åˆ†æå¼•æ“
â”‚   â”œâ”€â”€ threat_intel.py       # å¨èƒæƒ…æŠ¥
â”‚   â”œâ”€â”€ decision_engine.py    # å†³ç­–èåˆå¼•æ“
â”‚   â”œâ”€â”€ report_generator.py   # æŠ¥å‘Šç”Ÿæˆ
â”‚   â”œâ”€â”€ integrated_engine.py  # ç»¼åˆåˆ†æå¼•æ“
â”‚   â””â”€â”€ monitor.py            # ç›‘æ§å·¥å…·
â”œâ”€â”€ backend/                   # Web API åç«¯
â”‚   â””â”€â”€ app.py                # Flask API æœåŠ¡
â”œâ”€â”€ web-ui/                    # Web ç®¡ç†ç•Œé¢
â”œâ”€â”€ config/                    # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ detection.yaml        # æ£€æµ‹è§„åˆ™é…ç½®
â”œâ”€â”€ deploy/                    # Docker éƒ¨ç½²
â”‚   â”œâ”€â”€ deploy.sh             # è‡ªåŠ¨éƒ¨ç½²è„šæœ¬
â”‚   â””â”€â”€ docker-entrypoint.sh  # å®¹å™¨å…¥å£è„šæœ¬
â”œâ”€â”€ Dockerfile                 # Docker é•œåƒå®šä¹‰
â”œâ”€â”€ docker-compose.yml         # Docker Compose é…ç½®
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ DOCKER_DEPLOYMENT.md       # Docker éƒ¨ç½²æ–‡æ¡£
â””â”€â”€ requirements.txt          # Python ä¾èµ–
```

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆDocker éƒ¨ç½²ï¼‰

### 1. ä¸‹è½½éƒ¨ç½²åŒ…

ä» GitHub Actions ä¸‹è½½ `cap-agent-release.tar.gz`

### 2. è§£å‹å¹¶éƒ¨ç½²

```bash
# è§£å‹éƒ¨ç½²åŒ…
tar -xzf cap-agent-release.tar.gz
cd cap-agent-release

# ä¸€é”®éƒ¨ç½²ï¼ˆè‡ªåŠ¨æ£€æµ‹å¹¶å®‰è£… Docker ç¯å¢ƒï¼‰
sudo ./deploy/deploy.sh
```

### 3. éªŒè¯æœåŠ¡

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker compose ps

# æŸ¥çœ‹ Zeek è¿è¡ŒçŠ¶æ€
docker compose exec cap-agent zeekctl status

# è®¿é—® Web ç®¡ç†ç•Œé¢
# http://YOUR_IP:5000
```

### 4. æŸ¥çœ‹æ—¥å¿—å’Œå‘Šè­¦

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker compose logs -f cap-agent

# è¿›å…¥å®¹å™¨æŸ¥çœ‹ Zeek æ—¥å¿—
docker compose exec cap-agent tail -f /var/spool/zeek/current/lateral_movement.log

# ç”Ÿæˆæ£€æµ‹æŠ¥å‘Š
docker compose exec cap-agent-analyzer python3 \
  /opt/cap-agent/analyzer/integrated_engine.py \
  -i /var/spool/zeek/current/conn.log \
  -r /opt/cap-agent/reports/report.html
```

## ğŸ“– æ£€æµ‹èƒ½åŠ›è¯¦è§£

### æ¨ªå‘æ‰«ææ£€æµ‹
- ç‰¹å¾ï¼šå•IPçŸ­æ—¶é—´å†…æ‰«æå¤§é‡å†…ç½‘ä¸»æœº
- é˜ˆå€¼ï¼šé»˜è®¤20å°ä¸»æœº/5åˆ†é’Ÿï¼ˆå¯é…ç½®ï¼‰
- æ£€æµ‹ç‡ï¼š95%+

### Pass-the-Hashæ”»å‡»
- ç‰¹å¾ï¼šç›¸åŒNTLM Hashåœ¨å¤šå°ä¸»æœºä½¿ç”¨
- é˜ˆå€¼ï¼š3å°ä¸»æœº/1å°æ—¶
- æ£€æµ‹ç‡ï¼š90%+

### PSExecè¿œç¨‹æ‰§è¡Œ
- ç‰¹å¾ï¼šå‘ADMIN$/C$å†™å…¥æ–‡ä»¶ + svcctlç®¡é“è®¿é—®
- æ£€æµ‹ç‡ï¼š90%+

### WMIè¿œç¨‹æ‰§è¡Œ
- ç‰¹å¾ï¼šè°ƒç”¨IWbemServicesç­‰WMIæ¥å£
- æ£€æµ‹ç‡ï¼š85%+

### C2 Beaconé€šä¿¡
- ç‰¹å¾ï¼šè§„å¾‹æ€§å¿ƒè·³ã€å›ºå®šé—´éš”ã€é•¿è¿æ¥å°æµé‡
- æ£€æµ‹ç‡ï¼š85%+

### JA3æŒ‡çº¹åŒ¹é…
- å†…ç½®æŒ‡çº¹åº“ï¼šMetasploitã€Cobalt Strikeã€Trickbotã€Dridex
- æ£€æµ‹ç‡ï¼š95%+

## ğŸ”§ é…ç½®è¯´æ˜

é…ç½®æ–‡ä»¶ä½äºå®¹å™¨å†…ï¼š`/opt/cap-agent/config/detection.yaml`

å¯é€šè¿‡æŒ‚è½½å·ä¿®æ”¹ï¼š

```bash
# 1. ä»å®¹å™¨å¤åˆ¶é…ç½®åˆ°ä¸»æœº
docker compose cp cap-agent:/opt/cap-agent/config/detection.yaml ./config/

# 2. ç¼–è¾‘é…ç½®æ–‡ä»¶
vim ./config/detection.yaml

# 3. é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ
docker compose restart cap-agent-analyzer
```

é…ç½®ç¤ºä¾‹ï¼š

```yaml
detection:
  scan:
    threshold: 20              # æ‰«ææ£€æµ‹é˜ˆå€¼
    time_window: 300           # æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
    min_fail_rate: 0.6         # æœ€å°å¤±è´¥ç‡
  
  authentication:
    fail_threshold: 5          # è®¤è¯å¤±è´¥é˜ˆå€¼
    pth_window: 3600          # PTHæ£€æµ‹çª—å£

network:
  whitelist:                   # ç™½åå•é…ç½®
    enabled: true
    monitoring_systems:
      - "192.168.1.100"        # ç›‘æ§ç³»ç»Ÿ

ml_model:
  enabled: true
  contamination: 0.01          # å¼‚å¸¸æ¯”ä¾‹

decision_engine:
  thresholds:
    auto_block: 0.9999         # è‡ªåŠ¨é˜»æ–­é˜ˆå€¼
    urgent_alert: 0.99         # ç´§æ€¥å‘Šè­¦é˜ˆå€¼
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ |
|-----|------|
| æ”¯æŒæµé‡ | 10Gbpsï¼ˆå•å®ä¾‹ï¼‰ |
| æ£€æµ‹å»¶è¿Ÿ | <100ms |
| CPUå ç”¨ | <60%ï¼ˆ8æ ¸ï¼‰ |
| å†…å­˜å ç”¨ | <8GB |
| æ¨ªå‘ç§»åŠ¨æ£€æµ‹ç‡ | 90%+ |
| ç»¼åˆå‡†ç¡®ç‡ | 95%+ |
| è¯¯æŠ¥ç‡ | <5% |

## ğŸ›¡ï¸ æ£€æµ‹çŸ©é˜µ

| æ”»å‡»é˜¶æ®µ | æ£€æµ‹èƒ½åŠ› | å‡†ç¡®ç‡ |
|---------|---------|--------|
| æ¨ªå‘æ‰«æ | âœ… å®Œå…¨æ”¯æŒ | 95% |
| å‡­è¯è·å– | âœ… PTH/PTTæ£€æµ‹ | 90% |
| æ¨ªå‘ç§»åŠ¨ | âœ… å®Œå…¨æ”¯æŒ | 90% |
| C2é€šä¿¡ | âœ… è¡Œä¸ºåˆ†æ | 85% |
| æ•°æ®æ¸—å‡º | âœ… æµé‡åˆ†æ | 80% |
| Webæ”»å‡»(HTTPS) | âš ï¸ å…ƒæ•°æ®åˆ†æ | 30% |
| æœ¬åœ°ææƒ | âŒ éœ€EDR | 0% |

## ğŸ”— é›†æˆæ–¹æ¡ˆ

### SIEMé›†æˆ
- Splunk
- ELK Stack
- QRadar

### å‘Šè­¦è¾“å‡º
- Syslog
- Kafka
- Webhook
- é‚®ä»¶é€šçŸ¥

## ğŸ“š å®Œæ•´æ–‡æ¡£

è¯¦ç»†éƒ¨ç½²å’Œä½¿ç”¨è¯´æ˜è¯·å‚è€ƒï¼š**[DOCKER_DEPLOYMENT.md](./DOCKER_DEPLOYMENT.md)**

åŒ…å«å†…å®¹ï¼š
- Docker ç¯å¢ƒè¦æ±‚
- è¯¦ç»†éƒ¨ç½²æ­¥éª¤
- é…ç½®ä¼˜åŒ–æŒ‡å—
- æ•…éšœæ’æŸ¥æ‰‹å†Œ
- æ€§èƒ½è°ƒä¼˜æ–¹æ³•
- è¿ç»´ç®¡ç†å‘½ä»¤

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

**Docker ç¯å¢ƒ**ï¼š
- Docker 20.10+
- Docker Compose 2.0+
- ä¸»æœºå…·æœ‰ç½‘ç»œæŠ“åŒ…æƒé™

**ç¡¬ä»¶è¦æ±‚**ï¼š
- CPU: 8æ ¸+ï¼ˆæ¨è16æ ¸ï¼‰
- å†…å­˜: 16GB+ï¼ˆæ¨è32GBï¼‰
- ç£ç›˜: 500GB+

**æ“ä½œç³»ç»Ÿ**ï¼š
- CentOS 7/8
- Ubuntu 18.04/20.04/22.04
- RHEL 7/8
- Rocky Linux 8/9
- Anolis OS 8

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å®‰å…¨ç ”ç©¶å’Œé˜²å¾¡ä½¿ç”¨ï¼Œç¦æ­¢ç”¨äºéæ³•ç›®çš„ã€‚

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- é—®é¢˜åé¦ˆï¼šæäº¤ GitHub Issue
- æ–‡æ¡£ï¼šæŸ¥çœ‹ DOCKER_DEPLOYMENT.md
- æ›´æ–°ï¼šå®šæœŸå…³æ³¨é¡¹ç›®æ›´æ–°

---

**ç‰ˆæœ¬å†å²**ï¼š
- v2.0 (2025-12-23): 
  - âœ¨ Docker å®¹å™¨åŒ–éƒ¨ç½²
  - âœ¨ è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼ˆæ”¯æŒå¤šç§ Linux å‘è¡Œç‰ˆï¼‰
  - âœ¨ å®Œæ•´çš„ Docker éƒ¨ç½²æ–‡æ¡£
  - âœ¨ æ·±åº¦åŒ…æ£€æµ‹ï¼ˆDPIï¼‰
  - âœ¨ åŠ å¯†æµé‡åˆ†æ
  - âœ¨ 0day æ¼æ´åˆ©ç”¨æ£€æµ‹
  - âœ¨ æ”»å‡»é“¾å…³è”åˆ†æ
  - âœ¨ ML å¼‚å¸¸æ£€æµ‹
  - âœ¨ å›¾åˆ†æå¼•æ“
  - âœ¨ å¨èƒæƒ…æŠ¥é›†æˆ
  - âœ¨ å¤šå±‚å†³ç­–èåˆ
  - âœ¨ å¯è§†åŒ–æŠ¥å‘Š

---

ğŸ”’ **å®‰å…¨ç¬¬ä¸€ï¼Œé˜²å¾¡è‡³ä¸Šï¼**